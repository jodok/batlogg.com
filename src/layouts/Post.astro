---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import { getCategoryColor } from '../utils/categoryColor';

type Props = CollectionEntry<'posts'>['data'];

const { title, description, categories, pubDate, updatedDate, heroImage } = Astro.props;
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} image={heroImage} />
  </head>
  <body class="bg-white text-gray-900">
    <Nav />
    <main class="pt-14">
      {heroImage && (
        <div class="w-full h-[360px] md:h-[480px] overflow-hidden bg-gray-100">
          <Image width={1400} height={600} src={heroImage} alt="" class="w-full h-full object-cover" />
        </div>
      )}

      <article class="max-w-[680px] mx-auto px-6 pt-6 pb-20">
        <div class="flex items-center gap-3 mb-4 flex-wrap">
          {categories?.map((cat: string) => {
            const catColor = getCategoryColor(cat);
            return (
              <a
                href={`/category/${encodeURIComponent(cat)}`}
                class="rounded-full px-2.5 py-0.5 text-xs font-medium transition-opacity hover:opacity-80"
                style={`color: ${catColor}; background: ${catColor}1a;`}
              >
                {cat}
              </a>
            );
          })}
          <span class="text-xs text-gray-400">
            <FormattedDate date={pubDate} />
          </span>
        </div>

        <h1 class="text-4xl md:text-5xl font-bold leading-tight mb-6">{title}</h1>
        {description && <p class="text-lg text-gray-500 leading-relaxed mb-10">{description}</p>}

        {updatedDate && (
          <p class="text-xs text-gray-400 mb-6">
            Last updated on <FormattedDate date={updatedDate} />
          </p>
        )}

        <div class="post-content">
          <slot />
        </div>

        <!-- Author -->
        <div class="border-t border-gray-100 mt-12 pt-8 flex items-center gap-4">
          <div class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center text-gray-400 text-sm font-medium">JB</div>
          <div>
            <p class="font-semibold text-sm">Jodok Batlogg</p>
            <p class="text-gray-400 text-xs">Co-Founder & CEO at Pina Earth</p>
          </div>
        </div>
      </article>
    </main>
    <Footer />
  </body>
</html>
