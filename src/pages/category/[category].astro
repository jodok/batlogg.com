---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Post from '../../components/Posts.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection('posts');
  const categories = [...new Set(allPosts.flatMap((post) => post.data.categories ?? []))];

  return categories.map((category) => ({
    params: { category },
  }));
}

const { category } = Astro.params;
const filteredPosts = (await getCollection(
  'posts',
  ({ data }) => !!category && data.categories?.includes(category),
))
  .sort(
    (a, b) =>
      b.data.pubDate.valueOf() -
      a.data.pubDate.valueOf(),
  );

---

<BaseLayout>
  <h1>Category: {category}</h1>
	<section>
    <Post posts={filteredPosts} />
	</section>
</BaseLayout>
